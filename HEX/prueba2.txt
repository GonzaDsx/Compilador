int izqA = 9; //amarillo arriba
int izqB = 8; //verde abajo
int derA = 7; //verde arriba
int derB = 6; //amarillo abajo
int vel = 255;
boolean b = false;

int pecho = 2;            // define el pin 2 como (pecho) para el Ultrasonido
int ptrig = 3;    
int duracion, distancia; 
int sensorProximidad = 2;
volatile long contador = 0;

void setup(){  
  pinMode(13,OUTPUT); //led que prende cuando hay obstaculos
  pinMode(pecho, INPUT);   // define el pin 2 como entrada (pecho) 
  pinMode(ptrig,OUTPUT); 
  pinMode(izqA,OUTPUT); 
  pinMode(izqB,OUTPUT); 
  pinMode(derA,OUTPUT); 
  pinMode(izqB,OUTPUT); 
  pinMode(sensorProximidad, INPUT);
  //attachInterrupt(digitalPinToInterrupt(2), detener, LOW);
}

void loop(){ 
  if(b == false){          
      avanzar(10);  
      b = true;    
  }  
}

void avanzar(long tiempo){    
  contador = tiempo*21500;
  
  digitalWrite(ptrig, HIGH);   // genera el pulso de trigger por 10us
  delay(0.01);
  digitalWrite(ptrig, LOW);
      
  duracion = pulseIn(pecho, HIGH);          // Lee el tiempo del Echo
  distancia = (duracion/2) / 29;    
  
  while(contador >= 0){
    analogWrite(derB, 0);     
    analogWrite(izqB, 0); 
    analogWrite(derA, vel);  
    analogWrite(izqA, vel);    
    while(distancia <= 5 && distancia >=2){
      detener();
      digitalWrite(ptrig, HIGH);   // genera el pulso de trigger por 10us
      delay(0.01);
      digitalWrite(ptrig, LOW);
      
      duracion = pulseIn(pecho, HIGH);          // Lee el tiempo del Echo
      distancia = (duracion/2) / 29; 
    }
    contador--;
  }
  contador = 0;
  return;
}

void detener(){
  analogWrite(derB, 0);     
  analogWrite(izqB, 0); 
  analogWrite(derA, 0);    
  analogWrite(izqA, 0); 
}


void retroceder(long tiempo){    
  contador = tiempo*80;
  
  while(contador >= 0){
    digitalWrite(ptrig, HIGH);   // genera el pulso de trigger por 10us
    delayMicroseconds(10);
    digitalWrite(ptrig, LOW);
        
    duracion = pulseIn(pecho, HIGH);          // Lee el tiempo del Echo
    distancia = (duracion/2) / 29;    
    
    analogWrite(derA, 0);     
    analogWrite(izqA, 0); 
    analogWrite(derB, vel);  
    analogWrite(izqB, vel);    
    while(distancia <= 10){
      detener();
      digitalWrite(ptrig, HIGH);   // genera el pulso de trigger por 10us
      delayMicroseconds(10);
      digitalWrite(ptrig, LOW);
      
      duracion = pulseIn(pecho, HIGH);          // Lee el tiempo del Echo
      distancia = (duracion/2) / 29; 
      delay(10);
    }
    contador--;
    delay(10);
  }
  contador = 0;
  return;
}